<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Area-105 Personnel File</title>

    <!-- Bootstrap & Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <!-- Modern font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --accent-blue: #f1c76e;
            --accent-blue-soft: #e3f2ff;
            --border-soft: #e2e8f0;
            --bg-page: #f4f5f7;
            --text-muted: #6b7280;
            --border-accent-left: #2a2b2e;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: "Inter", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
                sans-serif;
            background-color: var(--bg-page);
            color: #111827;
        }

        /* Top nav */
        .top-nav {
            backdrop-filter: blur(12px);
            background-color: rgba(255, 255, 255, 0.9);
            border-bottom: 1px solid rgba(148, 163, 184, 0.4);
        }

        .brand-mark {
            font-weight: 700;
            letter-spacing: 0.16em;
            font-size: 0.8rem;
            text-transform: uppercase;
            color: #0f172a;
        }

        .brand-logo {
            width: 36px;
            height: 36px;
            border-radius: 0.75rem;
            object-fit: contain;
        }

        .brand-sub {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.18em;
            color: var(--text-muted);
        }

        /* Hero header */
        .hero-header {
            position: relative;
            overflow: hidden;
            border-bottom: 1px solid var(--border-soft);
            background-image: url("https://pbs.twimg.com/media/GxK2IrHbwAAdz3p?format=jpg&name=4096x4096");
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .hero-overlay-grid {
            position: absolute;
            inset: 0;
            background-image:
                linear-gradient(to right, rgba(148, 163, 184, 0.18) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(148, 163, 184, 0.16) 1px, transparent 1px);
            background-size: 40px 40px;
            mix-blend-mode: soft-light;
            opacity: 0.4;
            pointer-events: none;
        }

        .hero-dot-layer {
            position: absolute;
            inset: 0;
            background-image: radial-gradient(circle, rgba(245, 180, 0, 0.8) 2px, transparent 2px);
            background-size: 48px 48px;
            mix-blend-mode: soft-light;
            opacity: 0.2;
            pointer-events: none;
        }

        .hero-content {
            position: relative;
            z-index: 1;
            padding-top: 2.5rem;
            padding-bottom: 1.5rem;
        }

        .hero-pill {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.3rem 0.75rem;
            border-radius: 999px;
            background-color: #e2e2e2f5;
            color: #000000;
            font-size: 0.72rem;
            text-transform: uppercase;
            letter-spacing: 0.13em;
        }

        .hero-pill span {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
        }

        .text-secondary.subtext_text-secondary {
            color: #937a45 !important;
        }

        .hero-title {
            font-weight: 700;
            font-size: clamp(1.9rem, 2.9vw, 2.4rem);
            text-transform: uppercase;
            letter-spacing: 0.28em;
            color: #d7d7d7;
        }

        .hero-subtitle {
            font-size: 0.85rem;
            letter-spacing: 0.18em;
            text-transform: uppercase;
            color: #84848d;
        }

        .scp-panel {
            --scp-accent: #059669;
            --scp-text: #111827;
            background-color: rgba(209, 250, 229, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            min-width: 460px;
            padding: 1.1rem 2rem;
            border-left: 10px solid var(--scp-accent);
            box-shadow: 0 14px 26px rgba(15, 23, 42, 0.18);
            border-radius: 12px 5px 5px 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .scp-panel-label {
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.5em;
            color: rgb(54, 54, 54);
            margin-bottom: 0.05rem;
        }

        .scp-panel-value {
            font-size: 1.3rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--scp-text);
        }

        /* เส้นฟ้าคู่ใต้ชื่อ */
        .hero-accent-lines {
            margin-top: 1.25rem;
            margin-bottom: 0.25rem;
            display: flex;
            flex-direction: column;
            gap: 4px;
            max-width: 420px;
        }

        .hero-accent-line-main {
            height: 5px;
            border-radius: 999px;
            background-color: var(--accent-blue);
        }

        .hero-accent-line-sub {
            height: 3px;
            border-radius: 999px;
            background-color: var(--accent-blue);
            opacity: 0.85;
            width: 80%;
        }

        /* Main layout */
        main {
            padding-top: 1.75rem;
            padding-bottom: 2.5rem;
        }

        .card-soft {
            border-radius: 1rem;
            border: 1px solid var(--border-soft);
            background-color: #ffffff;
            box-shadow:
                0 18px 40px rgba(15, 23, 42, 0.04),
                0 0 0 1px rgba(15, 23, 42, 0.01);
        }

        .avatar-frame {
            position: relative;
            border-radius: 1rem;
            overflow: hidden;
            border: 1px solid rgba(148, 163, 184, 0.5);
        }

        .avatar-frame::before {
            content: "";
            position: absolute;
            inset: 0;
            border-radius: inherit;
            border: 2px solid rgba(255, 255, 255, 0.9);
            mix-blend-mode: soft-light;
            pointer-events: none;
        }

        .avatar-frame img {
            display: block;
            width: 100%;
            height: auto;
            object-fit: cover;
        }

        .meta-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.14em;
            color: var(--text-muted);
        }

        .meta-value {
            font-size: 0.9rem;
            font-weight: 500;
        }

        /* ===== Chip / Panel-like tags ===== */
        .tag-chip {
            --tag-accent: var(--accent-blue);
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            padding: 0.4rem 0.9rem;
            font-size: 0.8rem;
            background-color: #f9fafb;
            color: #111827;
            border-left: 5px solid var(--tag-accent);
            box-shadow: 0 2px 4px rgba(15, 23, 42, 0.06);
            margin: 0.15rem 0;
        }

        .tag-chip i {
            font-size: 1rem;
        }

        #personDepartmentChip {
            display: flex;
            align-items: center;
            width: 100%;
            margin-bottom: 0.75rem;
        }

        #personTags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.35rem 0.6rem;
            align-items: flex-start;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            margin-bottom: 0.25rem;
        }

        .section-icon {
            width: 2.3rem;
            height: 2.3rem;
            border-radius: 0.9rem;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: var(--accent-blue-soft);
            color: var(--accent-blue);
            flex-shrink: 0;
            font-size: 1.1rem;
        }

        .section-title {
            font-size: 0.92rem;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.16em;
            color: #0f172a;
        }

        .section-subtitle {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .section-body p {
            font-size: 0.92rem;
            color: #111827;
            line-height: 1.6;
        }

        .section-body ul {
            padding-left: 1.1rem;
            margin-bottom: 0;
        }

        .section-body li {
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .timeline-dot {
            width: 0.55rem;
            height: 0.55rem;
            border-radius: 999px;
            background-color: rgb(174, 93, 93);
            margin-top: 0.25rem;
        }

        .timeline-item {
            position: relative;
            padding-left: 1.5rem;
            margin-bottom: 1rem;
        }

        .timeline-item::before {
            content: "";
            position: absolute;
            left: 0.3rem;
            top: 0.6rem;
            bottom: -0.6rem;
            width: 1px;
            background: linear-gradient(to bottom, rgba(148, 163, 184, 0.9), transparent);
        }

        .timeline-item:last-child::before {
            bottom: 0.8rem;
        }

        .timeline-title {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .timeline-meta {
            font-size: 0.78rem;
            color: var(--text-muted);
        }

        .border-accent-left {
            border-left: 3px solid var(--border-accent-left);
            padding-left: 0.75rem;
        }

        /* ===== Simple fade/slide animation on load ===== */
        .fade-in-up {
            opacity: 0;
            transform: translateY(10px);
            transition: opacity 0.5s ease-out, transform 0.5s ease-out;
        }

        .fade-in-up.show {
            opacity: 1;
            transform: translateY(0);
        }

        @media (max-width: 991.98px) {
            .hero-content {
                padding-top: 1.75rem;
                padding-bottom: 1.25rem;
            }

            .hero-accent-lines {
                max-width: 100%;
            }

            .scp-panel {
                min-width: 100%;
            }
        }

        /* ===== Loading Screen Overlay ===== */
        .loading-screen {
            position: fixed;
            inset: 0;
            background: #ffffff;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transform: translateY(0);
            opacity: 1;
            transition:
                transform 2.5s cubic-bezier(0.19, 1, 0.22, 1),
                opacity 0.4s ease-out;
        }

        .loading-screen.hide {
            transform: translateY(-105%);
            pointer-events: none;
        }

        .loading-logo {
            width: 156px;
            height: 156px;
            border-radius: 16px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1.25rem;
            background: #111827;
        }

        .loading-logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .loading-title {
            font-size: 1.2rem;
            font-weight: 700;
            letter-spacing: 0.35em;
            text-transform: uppercase;
            color: #111827;
            margin-bottom: 0.35rem;
        }

        .loading-sub {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.26em;
            color: #9ca3af;
        }

        .loading-bar {
            width: 96px;
            height: 2px;
            border-radius: 999px;
            background: #e5e7eb;
            overflow: hidden;
            position: relative;
            margin-top: 1.75rem;
        }

        .loading-bar::before {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, #f3f3f3, #868686, #ffffff);
            transform: translateX(-100%);
            animation: loadingBarSlide 1.2s infinite;
        }

        @keyframes loadingBarSlide {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(100%);
            }
        }

        .loading-dim {
            position: fixed;
            inset: 0;
            z-index: 9998;
            background: rgba(0, 0, 0, 0.25);
            backdrop-filter: blur(20px) brightness(0.2);
            -webkit-backdrop-filter: blur(20px) brightness(0.2);
            opacity: 1;
            transition: opacity 1.0s ease-out;
        }

        .loading-dim.hide {
            opacity: 0;
            pointer-events: none;
        }

        .nav-badge {
            font-size: 0.7rem;
            letter-spacing: 0.16em;
            text-transform: uppercase;
            padding: 0.15rem 0.75rem;
            border-radius: 999px;
            border: 1px solid rgba(148, 163, 184, 0.9);
            color: #111827;
            background-color: #f9fafb;
        }

        /* Error text in hero (กรณีไม่เจอ / ไม่มี id) */
        .hero-error {
            margin-top: 0.75rem;
            font-size: 0.8rem;
            color: #b91c1c;
            text-transform: none;
            letter-spacing: 0;
        }


        /* ===== Mobile (x2 font size) ===== */
        @media (max-width: 1070px) {
            body {
                font-size: 23px;
            }

            .scp-panel {
                min-width: 100%;
                padding: 0.9rem 1.2rem;
                border-left-width: 8px;
            }

            main {
                padding-top: 1.25rem;
                padding-bottom: 1.75rem;
            }
            
            .card-soft {
                border-radius: 0.9rem;
            }

            .avatar-frame {
                border-radius: 0.9rem;
            }

            .meta-label {
                font-size: 1.6rem;
                letter-spacing: 0.12em;
            }

            .meta-value {
                font-size: 1.96rem;
            }

            .tag-chip {
                font-size: 1.8rem;
                padding: 0.45rem 1rem;
            }

            .section-title {
                font-size: 2rem;
                letter-spacing: 0.14em;
            }

            .section-subtitle {
                font-size: 1.8rem;
            }

            .section-body p {
                font-size: 2rem;
                line-height: 1.7;
            }

            .section-body li {
                font-size: 1.92rem;

            }

            .timeline-title {
                font-size: 1.92rem;

            }

            .timeline-meta {
                font-size: 1.7rem;
            }


            .section-icon {
                width: 5.5rem;
                height: 5.5rem;
                border-radius: 2.3rem;
                font-size: 2.5rem;
                margin-right: 9px;
            }

            .section-icon i {
                font-size: 2.5rem;
            }


            .tag-chip i {
                font-size: 1.7rem;
                margin-right: 7px;
            }


            .hero-pill i {
                font-size: 1.2rem;
            }
            .card-soft h2 {
                 font-size: 2.5rem;
            }
            .timeline-dot {
                width: 1rem;
                height: 1rem;
                border-radius: 999px;
                background-color: rgb(174, 93, 93);
                margin-top: 0.9rem;
                margin-right: 0.5rem;
            }
        }
    </style>
</head>

<body>
    <!-- Loading Screen Overlay -->
    <div id="loadingScreen" class="loading-screen">
        <div class="loading-logo">
            <img src="https://cdn.jsdelivr.net/gh/InterSecure-TheFoundation/area105-assets@main/images/ui/Logo_A105.png"
                alt="Area-105 logo">
        </div>
        <div class="loading-title">AREA-105</div>
        <div class="loading-sub">PERSONNEL REGISTRY</div>
        <div class="loading-bar"></div>
    </div>
    <div id="loadingDim" class="loading-dim"></div>

    <!-- Top Navigation -->
    <header class="top-nav py-2">
        <div class="container-xl d-flex justify-content-between align-items-center">
            <!-- ซ้าย: โลโก้ + ชื่อ -->
            <div class="d-flex align-items-center gap-3">
                <img src="https://cdn.jsdelivr.net/gh/InterSecure-TheFoundation/area105-assets@main/images/ui/Logo_A105.png"
                    alt="Area-105 Logo" class="brand-logo">
                <div>
                    <div class="brand-mark">Area-105</div>
                    <div class="brand-sub">Personnel Registry · Secure · Contain · Protect</div>
                </div>
            </div>

            <!-- ขวา: ข้อความ access -->
            <div class="d-flex align-items-center gap-3">
                <div class="d-flex align-items-center gap-2">
                    <span class="nav-badge d-none d-md-inline">
                        ACCESS: INTERNAL USE ONLY
                    </span>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Header -->
    <section class="hero-header">
        <div class="hero-overlay-grid"></div>
        <div class="hero-dot-layer"></div>
        <div class="container-xl hero-content">

            <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-start gap-3 fade-in-up">
                <!-- Left: name -->
                <div class="text-start">
                    <div class="hero-pill mb-3">
                        <span><i class="bi bi-folder2-open"></i> Personnel File</span>
                        <span class="text-uppercase">
                            <span class="text-secondary subtext_text-secondary">Site:</span> Area-105
                        </span>
                    </div>

                    <div class="hero-subtitle mb-1">Item # <span id="heroPersonnelId">A105-XXX</span></div>
                    <div class="hero-title mb-1" id="heroPersonnelName">[Name]</div>
                    <div class="hero-subtitle" id="heroPersonnelRole">[Role / Division]</div>
                    <div id="heroError" class="hero-error d-none"></div>

                    <div class="hero-accent-lines mt-3">
                        <div class="hero-accent-line-main"></div>
                        <div class="hero-accent-line-sub"></div>
                    </div>
                </div>

                <!-- Right: SCP-style panels -->
                <div class="d-flex flex-column align-items-md-end gap-3">
                    <!-- Clearance panel -->
                    <div id="clearancePanel" class="scp-panel fade-in-up">
                        <div class="scp-panel-label">CLEARANCE LEVEL</div>
                        <div id="clearanceValue" class="scp-panel-value">LEVEL 2</div>
                    </div>

                    <!-- File status panel -->
                    <div id="statusPanel" class="scp-panel fade-in-up">
                        <div class="scp-panel-label">FILE STATUS</div>
                        <div id="statusValue" class="scp-panel-value">ACTIVE DUTY</div>
                    </div>
                </div>
            </div>

        </div>
    </section>

    <!-- Main Content -->
    <main>
        <div class="container-xl">
            <div class="row g-4 g-xl-5">

                <!-- Left column -->
                <div class="col-lg-4">
                    <div class="card-soft p-3 p-lg-4 mb-3 fade-in-up">
                        <div class="avatar-frame mb-3">
                            <img id="personAvatar" src="" alt="Personnel portrait">
                        </div>

                        <h2 class="h4 mb-1" id="personDisplayName">[Full Name]</h2>
                        <div class="text-muted mb-3" id="personAlias">[Alias / Call sign]</div>

                        <div class="mb-3">
                            <span class="tag-chip" id="personDepartmentChip">
                                <i class="bi bi-diagram-3"></i>
                                <span id="personDepartment">Department</span>
                            </span>
                        </div>

                        <div class="row gy-2">
                            <div class="col-6">
                                <div class="meta-label">Position</div>
                                <div class="meta-value" id="personRole">—</div>
                            </div>
                            <div class="col-6">
                                <div class="meta-label">Location</div>
                                <div class="meta-value" id="personLocation">—</div>
                            </div>
                            <div class="col-6">
                                <div class="meta-label">Risk Profile</div>
                                <div class="meta-value" id="personRiskProfile">—</div>
                            </div>
                            <div class="col-6">
                                <div class="meta-label">Extension</div>
                                <div class="meta-value" id="personPhone">—</div>
                            </div>
                            <div class="col-12">
                                <div class="meta-label">Contact</div>
                                <div class="meta-value">
                                    <a href="#" id="personEmailLink">—</a>
                                </div>
                            </div>
                        </div>

                        <hr class="my-3">

                        <div>
                            <div class="meta-label mb-1">Specialisation</div>
                            <div id="personTags"></div>
                        </div>
                    </div>

                    <div class="card-soft p-3 p-lg-4 small fade-in-up">
                        <div class="border-accent-left">
                            <div class="meta-label mb-1">Access Notice</div>
                            <p class="mb-2">
                                This file is restricted to Area-105 staff with matching or higher clearance
                                than the subject. Distribute on a need-to-know basis only.
                            </p>
                            <p class="text-muted mb-0">
                                Any anomalous behaviour or deviation from baseline personality profile must
                                be reported to Site Director within 24 hours.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Right column -->
                <div class="col-lg-8">
                    <div id="sectionContainer" class="vstack gap-3 gap-lg-4">
                        <!-- Sections injected from JSON -->
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Render JSON from backend API -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {

            const API_BASE = "https://script.google.com/macros/s/AKfycbz-DS0yA5iorJMVJ8xmgXxPqvy-it2BgLk3xRLMm_RHETOL4lJTHrmAgDqvT0AOnOUuWQ/exec";
            const INDEX_URL = "index.html";

            const loadingEl = document.getElementById("loadingScreen");
            const loadingDim = document.getElementById("loadingDim");

            const startFadeInContent = () => {
                const animatedEls = document.querySelectorAll(".fade-in-up");
                animatedEls.forEach((el, index) => {
                    el.style.transitionDelay = (index * 80) + "ms";
                    el.classList.add("show");
                });
            };

            const hideLoading = () => {
                if (!loadingEl) {
                    startFadeInContent();
                    return;
                }
                setTimeout(() => {
                    loadingEl.classList.add("hide");
                    setTimeout(() => {
                        if (loadingDim) {
                            loadingDim.classList.add("hide");
                        }
                        setTimeout(() => {
                            startFadeInContent();
                        }, 100);
                    }, 800);
                }, 500);
            };

            const setText = (id, value, fallback) => {
                const el = document.getElementById(id);
                if (el) el.textContent = value || fallback || "";
            };

            const showHeroError = (message) => {
                const el = document.getElementById("heroError");
                if (!el) return;
                el.textContent = message || "";
                el.classList.remove("d-none");
            };

            const setPanelColors = (panelId, config) => {
                if (!config) return;
                const panel = document.getElementById(panelId);
                if (!panel) return;
                if (config.accent_color) {
                    panel.style.setProperty("--scp-accent", config.accent_color);
                    panel.style.borderLeftColor = config.accent_color;
                }
                if (config.background_color) {
                    panel.style.backgroundColor = config.background_color;
                }
                if (config.text_color) {
                    panel.style.setProperty("--scp-text", config.text_color);
                }
            };

            const applyChipStyle = (el, config) => {
                if (!el || !config) return;
                const accent = config.accent_color;
                const bg = config.background_color;
                const text = config.text_color;
                if (accent) {
                    el.style.setProperty("--tag-accent", accent);
                    el.style.borderLeftColor = accent;
                }
                if (bg) {
                    el.style.backgroundColor = bg;
                }
                if (text) {
                    el.style.color = text;
                }
            };

            const renderPersonnel = (data) => {
                // Hero texts
                setText("heroPersonnelId", data.id, "A105-XXX");
                setText("heroPersonnelName", data.name, "[Name]");
                setText("heroPersonnelRole", data.role || data.department, "[Role / Division]");

                // Clearance / status
                const clearanceShort = data.clearance_short || data.clearance || "LEVEL ?";
                setText("clearanceValue", (clearanceShort + "").toUpperCase(), "LEVEL ?");
                const statusLabel = (data.status || "Unknown").toUpperCase();
                setText("statusValue", statusLabel, "STATUS");

                setPanelColors("clearancePanel", data.clearance_panel);
                setPanelColors("statusPanel", data.status_panel);

                // Profile info
                const imgEl = document.getElementById("personAvatar");
                if (imgEl) {
                    imgEl.src = data.profile_image || "";
                    imgEl.alt = data.name ? "Portrait of " + data.name : "Personnel portrait";
                }

                setText("personDisplayName", data.name, "[Full Name]");
                setText("personAlias", data.alias || "", "");
                setText("personDepartment", data.department || "Unassigned");
                setText("personRole", data.role || "—");
                setText("personLocation", data.location || "—");
                setText("personRiskProfile", data.risk_profile || "—");
                setText("personPhone", (data.contact && data.contact.phone) || "—");

                const emailLink = document.getElementById("personEmailLink");
                if (emailLink) {
                    const email = data.contact && data.contact.email;
                    if (email) {
                        emailLink.href = "mailto:" + email;
                        emailLink.textContent = email;
                    } else {
                        emailLink.removeAttribute("href");
                        emailLink.textContent = "—";
                    }
                }

                // Department chip style
                const deptChip = document.getElementById("personDepartmentChip");
                applyChipStyle(deptChip, data.department_chip);

                // Specialisation tags
                const tagsContainer = document.getElementById("personTags");
                if (tagsContainer && Array.isArray(data.tags)) {
                    tagsContainer.innerHTML = "";
                    data.tags.forEach((tag) => {
                        const span = document.createElement("span");
                        span.className = "tag-chip fade-in-up";

                        let label;
                        let iconClass = null;
                        let styleConfig = Object.assign({}, data.specialisation_chip || {});

                        if (typeof tag === "string") {
                            label = tag;
                        } else if (tag && typeof tag === "object") {
                            label = tag.label || tag.text || "";
                            iconClass = tag.icon || null;

                            if (tag.accent_color) styleConfig.accent_color = tag.accent_color;
                            if (tag.background_color) styleConfig.background_color = tag.background_color;
                            if (tag.text_color) styleConfig.text_color = tag.text_color;
                        } else {
                            label = String(tag);
                        }

                        if (iconClass) {
                            span.innerHTML = '<i class="bi ' + iconClass + '"></i><span>' + label + '</span>';
                        } else {
                            span.innerHTML = '<span>' + label + '</span>';
                        }

                        applyChipStyle(span, styleConfig);
                        tagsContainer.appendChild(span);
                    });
                }

                const sectionContainer = document.getElementById("sectionContainer");
                if (sectionContainer && Array.isArray(data.sections)) {
                    sectionContainer.innerHTML = "";
                    data.sections.forEach((section) => {
                        const card = document.createElement("section");
                        card.className = "card-soft p-3 p-lg-4 fade-in-up";
                        card.id = section.id || "";

                        const iconClass = section.icon || "bi-file-text";
                        const title = section.title || "Section";
                        const subtitle = section.subtitle || "";

                        const header = document.createElement("div");
                        header.className = "section-header";

                        const icon = document.createElement("div");
                        icon.className = "section-icon";
                        icon.innerHTML = '<i class="bi ' + iconClass + '"></i>';

                        if (section.icon_style) {
                            if (section.icon_style.bg) {
                                icon.style.backgroundColor = section.icon_style.bg;
                            }
                            if (section.icon_style.color) {
                                icon.style.color = section.icon_style.color;
                            }
                        }

                        const titleWrap = document.createElement("div");
                        const titleEl = document.createElement("div");
                        titleEl.className = "section-title";
                        titleEl.textContent = title;
                        titleWrap.appendChild(titleEl);

                        if (subtitle) {
                            const subEl = document.createElement("div");
                            subEl.className = "section-subtitle";
                            subEl.textContent = subtitle;
                            titleWrap.appendChild(subEl);
                        }

                        header.appendChild(icon);
                        header.appendChild(titleWrap);

                        const body = document.createElement("div");
                        body.className = "section-body mt-3";

                        if (section.body_html) {
                            body.innerHTML = section.body_html;
                        } else if (Array.isArray(section.paragraphs)) {
                            body.innerHTML = section.paragraphs.map((p) => "<p>" + p + "</p>").join("");
                        } else if (typeof section.body === "string") {
                            body.innerHTML = "<p>" + section.body + "</p>";
                        } else {
                            body.innerHTML = "<p class='text-muted small'>No data for this section.</p>";
                        }

                        card.appendChild(header);
                        card.appendChild(body);
                        sectionContainer.appendChild(card);
                    });
                }
            };

            // ======= เริ่มต้น: อ่าน id จาก URL + fetch ข้อมูล =======
            const params = new URLSearchParams(window.location.search);
            const personnelId = (params.get("id") || "").trim();

            if (!personnelId) {

                window.location.href = INDEX_URL;
                return;
            }

            setText("heroPersonnelId", personnelId, "A105-XXX");

            fetch(`${API_BASE}?id=${encodeURIComponent(personnelId)}`)
                .then(res => res.json())
                .then(payload => {

                    if (!payload || !payload.ok || payload.status !== "FOUND" || !payload.data) {

                        window.location.href = INDEX_URL;
                        return;
                    }

                    const data = payload.data;
                    renderPersonnel(data);

                    const idForTitle = data.id || personnelId;
                    document.title = `Area-105 Personnel File · ${idForTitle}`;
                })
                .catch(err => {
                    console.error("Error fetching personnel data:", err);

                    window.location.href = INDEX_URL;
                })
                .finally(() => {
                    hideLoading();
                });
        });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>